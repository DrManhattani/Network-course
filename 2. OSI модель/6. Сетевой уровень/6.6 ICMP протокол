

	* ICMP (Internet Control Message Protocol) - протокол межсетевых управляющих
	  сообщений. 

	ФУНКЦИИ ICMP:
		• оповещение об ошибках на сетевом уровне
		• может использоваться для диагностики работы сети даже, когда не возникают
		  ошибки
		* т.к. IP предоставляет сервис без гарантии доставки, то сообщения об ошибках
		  ICMP не обязаны обрабатываться ни протоколом ICMP, ни протоколом IP


	ФОРМАТ ПАКЕТА ICMP (ЗАГОЛОВКА):
		1-4 заголовок
		5	данные

		1. ТИП СООБЩЕНИЯ, 1 байт - говорит о том, что произошло в сети, какая ошибка или какое
		   действие по диагностике пытаются выполнить.
		2. КОД СООБЩЕНИЯ, 1 байт - более подробно описывается тип ошибки или ее причина, или
		   диагностическое действие.
		3. КОНТРОЛЬНАЯ СУММА, 2 байта - используется для проверки правильности доставки.
		4. СЛУЖЕБНАЯ ИНФОРМАЦИЯ, 4 байта - (зависит от типа и ввода сообщения).
		5. ПОЛЕ ДАННЫХ - как правило, фрагмент пакета, при передаче которого произошла ошибка.


	ТИПЫ СООБЩЕНИЙ:
		* Самое важное в протоколе ICMP - это тип сообщений, именно тип говорит о том, что
		  произошло в сети.

		ТИП	 |	НАЗНАЧЕНИЕ СООБЩЕНИЯ
		0	 |	Эхо-ответ
		3	 |	Узел назначения недостижим
		5	 |	Перенаправление маршрута
		8	 |	Эхо-запрос
		9	 |	Сообщение о маршрутизаторе
		10	 |	Запрос сообщения о маршрутизаторе
		11	 |	Истечение времени жизни пакета
		12	 |	Проблемы с параметрами
		13	 |	Запрос отметки времени
		14	 |	Ответ отметки времени

	КОДЫ СООБЩЕНИЙ:

		КОД  | ПРИЧИНА
		0	 | Суть недостижима
		1	 | Узел недостижим
		2	 | Протокол недостижим
		3	 | Порт недостижим
		4	 | Ошибка фрагментации
		5	 | Ошибка в маршруте источника
		6	 | Сеть назначения неизвеста
		7	 | Узел назначения неизвестен
		8	 | Узел-источник изолирован
		9	 | Административный запрет


	ПРИМЕНЕНИЕ ICMP:
		• Диагностика сети
		  - ping - используется для того, чтобы проверить доступность компьютера в сети.
			Возможно, подключиться к этому компьютеру в сети или нельзя.
			Используется эхо-протокол ICMP - компьютер, который хочет проверить доступность
				другого, отправляет эхо-запрос ICMP пакет, Тип сообщения 8, Код 0.
			Компьютер, получивший эхо-запрос отправляет эхо-ответ ICMP, Тип 0, Код 0.
			Если ответ не пришел, значит установить соединение с компьютером невозможно.
		  - traceroute (в Windows tracert) - определяет маршрут от отправителя к получателю.
			Находит адреса всех маршрутизаторов, через которые проходит пакет.
			
			КАК traceroute узнает маршрутизаторы?
			* Для этого утилита traceroute использует ICMP сообщение - время жизни истекло.
			  1. Сначала отправляется сообщение, у которого время жизни установлено 1.
			  2. Пакет доходит до первого маршрутизатора, маршрутизатор уменьшает пакет до 0,
				 Маршрутизатор отбрасывает пакет.
			  3. Генерируется сообщение с типом ошибки 11, код 0.
			  4. Утилита traceroute из заголовка IP пакета, в который вложен ICMP, извлекает IP
				 адрес маршрутизатора.
			  5. Следующим этапом отправляется ICMP пакет с временем жизни равным 2.
			  6. На первом пакете время жизни уменьшается до 1, пакет переходит на 2 маршрутизатор.
			  7. Второй маршрутизатор уменьшает время жизни на 1, и оно становится 0.
			  8. Пакет отбрасывается, второй маршрутизатор отправляет сообщение время жизни истекло.
			  9. Утилита traceroute извлекает IP-адрес второго маршрутизатора из IP-заголовка 
				 этого сообщения.
			  10. Так происходит до тех пор, пока пакет не дойдет до узла назначения.

