

	* DHCP (Dynamic Host Configuration Protocol) - протокол динамических конфигураций хостов.
	  Для работы в глобальной сети компьютеру нужен IP-адрес
	  IP-адрес можно назначить вручную, либо автоматически
	  - протокол DHCP позволяет автоматически назначать IP-адреса компьютерам в сети. Он является
		одним из управляющих протоколов сетевого уровня.
	  - чтобы использовать протокол DHCP, нужно использовать соответсвующую инфраструктуру. Нужно
		создать DHCP сервер и поддерживать его. 
	  - в разное время DHCP сервер одному и тому же компьютеру может назначать разные IP-адреса.

	КАК РАБОТАЕТ?
	  - DHCP работает по модели клиент-сервер. 
		• Клиент - компьютер, получающий IP-адрес. 
		• Сервер - компьютер, раздающий IP-адреса и следящий за тем, чтобы один и тот же IP-адрес 
		  не был выдан двум клиентам. В противном случае они не смогут работать с сетью.
		• Клиент и Сервер обмениваются между собой сообщениями DHCP в режиме запрос-ответ.

	КАК ПРОИСХОДИТ ПОЛУЧЕНИЕ IP-АДРЕСА:
	  1. Клиент включается, у него нет никакой информации о той сети, в которой он находится.
		 Его первая задача узнать, где находится DHCP сервер.
		 Для этого он посылает сообщение DHCP-discover на широковещательный MAC-адрес.
	  2. Это сообщение принимают все компьютеры в сети.
		 Сервер после того, как получил сообщение DHCP-discover, в ответ посылает сообщение
		 	DHCP-offer (предложение). В сообщении DHCP-сервер включает IP-адрес, который предлагает
		 	использовать клиенту.
	  3. В ответ клиент пересылает DHCP-серверу сообщение DHCP-request с тем же самым IP-адресом.
	  4. Сервер высылает подтверждающее сообщение DHCP-ACK (acknoledgement), куда еще раз включается
			IP-адрес.
	  5. После этого клиент может использовать IP-адрес для работы в сети.
		
		* Кроме этого есть другие сообщения DHCP-сервера:
		  • NACK - запрет использования запрошенного DHCP клиентом IP-адреса.
		  • RELEASE - освобождение IP-адреса, который уже не нужен клиенту.
		  • INFORM - запрос и передача дополнительной конфигурации о сети, если клиент уже знает
			свой IP-адрес и ему не надо его получать по протоколу DHCP.
	
	ПОЧЕМУ НУЖНО ИМЕННО 4 СООБЩЕНИЯ?
	  - в сети может быть 2 DHCP-сервера. В этом случае сообщение DISCOVER получат оба сервера.
		Оба сервера вышлют сообщение DHCP-OFFER со своим IP-адресом. Клиент выберет только один
		IP-адрес и этот IP-адрес включит в DHCP-REQUEST. Запрос опять получат оба сервера, но
		ответит на него только тот, который опознал свой IP-адрес.
	  - вторая проблема заключается в том, что при передаче IP-адреса сервером может произойти его
		искажение. Тогда клиент получит искаженный IP-адрес. При 3-х шагах клиент бы не знал, что
		он отпраил на DHCP-сервер искаженный IP-адрес. А при 4 сообщениях сервер отправит в ответ
		сообщение, что клиент не может использовать данный IP-адрес. Управляющим сообщением в
		данном случае будет NACK. После этого клиент подождет некоторое время и может начать 
		процесс получения IP заново.


	СПОСОБЫ НАЗНАЧЕНИЯ IP-АДРЕСОВ:
	  - Фиксированный - в этом случае в конфигурационных серверах DHCP-сервера для каждого MAC-адреса
		прописывается соответствующий ему IP-адрес, который DHCP-сервер должен выдавать клиенту.
		Это удобно делать в небольшой сети, где вы знаете MAC-адреса всех компьютеров.
	  	В крупной сети или, если вы не знаете MAC-адреса всех компьютеров, это сделать невозможно.
		Например, если вы делаете сеть в кафе, куда люди приходят со своими ноутбуками и смартфонами,
			вы не можете заранее знать MAC-адреса.
	  - Динамический - в этом случае у DHCP-сервера есть так называемый пул IP-адресов - это диапазон
		адресов, из которого DHCP-сервер может взять любой IP-адрес и назначить компьютеру. При этом
		DHCP-сервер следит за тем, чтобы один IP-адрес не был назначен двум компьютерам одновременно.
		DHCP-сервер выделяет IP-адрес клиенту на некоторое время, которое называется ВРЕМЕНЕМ АРЕНДЫ
			(lease time). Время аренды может быть разное в зависимости от потребности конкретной сети
			или организации - от нескольких часов до нескольких суток или больше.
		!После окончания аренды IP-адрес освобождается, и сервер может отдать его другому клиенту.
			!НО, если клиент хочет использовать данный IP-адрес дальше, ему необходимо продлить аренду.
			Обычно клиенты начинают это делать после того, как пройдет половина времени аренды.
		!Для продления аренды используется сокращенная процедура получения IP-адреса.
			- Т.к. клиент уже знает свой IP-адрес, он сразу пересылает сообщение DHCP-REQUEST, в
			  котором указывает этот IP-адрес.
			- Если все нормально, DHCP-сервер высылает подтверждение DHCP-ACK, говорящее, что клиент
			  может использовать этот IP-адрес дальше.
		!После того, как компьютер перестал работать с сетью, например, при выключении, ему необходимо
			сказать об этом DHCP-серверу. Для этого используется сообщение DHCP-RELEASE. После
			получения этого сообщения DHCP-сервер может отдать этот IP-адрес какому-то другому
			компьютеру в сети. Все современные ОС автоматически оповещают DHCP-сервер при корректном
			выключении.
		!Если сообщение DHCP-RELEASE не будет отправлено, например, при некорректном выключении или
			сбое в ОС, то DHCP-сервер будет считать этот IP-адрес занятым до окончания времени аренды.


	КОНФИГУРАЦИОННАЯ ИНФОРМАЦИЯ:
	  - Компьютеру для корректной работы в сети нужно знать не только IP-адрес. Как правило, нужно
		знать маску подсети и маршрутизатор по умолчанию. Также хорошо знать адреса серверов имен.
	  - DHCP позволяет передавать эти, а также некоторые другие сведения о конфигурации сети с помощью,
		так называемых, ОПЦИЙ. Опции включаются в пакет DHCP и передаются вместе с IP-адресом.
		Кроме маски подсети и маршрутизатора по умолчанию, обычно передается:
			• адреса DNS-серверов, которые используются для разрешения имен
			• адреса серверов времени
			• некоторые полезные локальные маршруты
			• другие опции 



	ПОИСК DHCP-СЕРВЕРА В СЕТИ:
	  - желательно, чтобы DHCP-сервер располагался в той же самой подсети, что и клиент, который будет
		получать IP-адреса по протоколу DHCP.
			ПОЧЕМУ ТАК?
			-- клиент DHCP при включении не знает, где находится DHCP-сервер и отправляет запрос
			   DHCP-DISCOVER на широковещательный адрес. Его получают все компьютеры, которые
			   находятся в данной подсети, в том числе и DHCP-сервер.
			-- если бы DHCP находился в другой сети, т.е. был отделен от клиента одним или несколькими
			   маршрутизаторами, маршрутизатор бы не передал широковещательный трафик, поэтому
			   сообщение DHCP-DISCOVER не доходит до сервера DHCP.
				--- для того, чтобы решить эту проблему, используется так называемый DHCP-RELAY.
					Это специальная конфигурация маршрутизаторов или маршрутизирующих коммутаторов,
					которая позволяет им передавать широковещательный трафик. НО не весь, а только
					тот, который относится к протоколу DHCP.

