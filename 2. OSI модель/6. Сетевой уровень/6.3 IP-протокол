

	I. IP - межсетевой протокол
		находится на сетевом уровне
		• цель протокола - объединить сети, построенные с помощью разных технологий канального
		  уровня, которые могут значительно отличаться друг от друга, в одну крупную объединенную
		  сеть, в которой компьютеры могут свободно общаться друг с другом, невзирая на различия
		  конкретной сетевой технологии
		• маршрутизация - задача, поиск маршрута от отправителя к получателю в крупной составной
		  сети через промежуточные узлы - маршрутизаторы.
		• обеспечивает необходимое качество обслуживания.


		1. СЕРВИСЫ IP
		   • передача данных происходит без гарантии доставки
		   • не гарантируется порядок следования сообщений
		   • протокол использует передачу данных без установки соединения, IP-пакет просто
			 отправляется в сеть в надежде, что он дойдет до получателя.
			 Если пакет не дошел, не принимается никаких попыток оповестить отправителя и
			 также не принимается никаких попыток запросить этот пакет снова.
			 Считается, что ошибка будет исправлена протоколами, которые находятся на
			 вышестоящих уровнях.

		2. ФОРМАТ ЗАГОЛОВКА IP-ПАКЕТА:
		
			1. Номер версии - 4 бита
			   - IPv4
			   - IPv6
			2. Длина заголовка - 4 бита
			   - в отличие от Ethernet заголовок IP включает обязательные поля, а также может
				 включать дополнительные поля, которые называются опции.
			   - в поле Длина заголовка записывается длина, как обязательной части, так и опций
			3. Тип сервиса - 8 бит
			   - поле нужно для обеспечения необходимого качества обслуживания, но сейчас на практике
				 используется очень редко.
			4. Общая длина - 16 бит
			   - длина пакета, включая заголовок и данные
			   - измеряется в байтах
			   - максимальное значение 65535 байт
			   - на практике такой большой размер не используется, а максимальный размер ограничен
				 размером кадра канального уровня
			5. Идентификатор пакета - 16 бит
			6. Флаги - 3 бита
			7. Смещение фрагмента - 13 бит
			   5-7 нужны для реализации фрагментации
			8. Время жизни - 8 бит
			   - Time to live - максимальное время, в течение которого пакет может перемещаться по сети
			   - Введено, чтобы пакеты не гуляли по сети бесконечно, если в конфигурации сети возникала
				 какая-то ошибка. Например, в результате неправильной настройки маршрутизаторов в сети
				 может образоваться петля.
			   - раньше измерялось в секундах. Теперь время жизни уменьшается на единицу в каждом
				 маршрутизаторе, и оно измеряется в количестве прохождений через маршрутизаторы (hop, прыжок).
			9. Тип протокола следующего уровня
			   - предназначено для реализации функции мультиплексирования/демультиплексирования. Т.е. передачи
				 с помощью протокола IP данных от разных протоколов следующего уровня.
			   - в этом поле указывается код протокола следующего уровня
				 • TCP - 6
				 • UDP - 17
				 • ICMP - 1
			10. Контрольная сумма - 16 бит
			    - используется для проверки правильности доставки пакета. Если при проверке контрольной суммы
				  обнаружены ошибки, то пакет отбрасывается. Никакой информации отправителю пакета не
				  отправляется.
				- контрольная сумма рассчитывается только по заголовку IP пакета
				- КС пересчитывается на каждом маршрутизаторе, из-за того что данные в заголовке меняются.
				  Как минимум изменяются время жизни пакета, а также могут измениться некоторые опции.
			11. IP-адрес отправителя - 32 бита
			12. IP-адрес получателя - 32 бита
			... Обязательная часть заголовка заканчивается. После этого идут необязательные поля, которые называются
				опции.
				Примеры опций:
				- Для диагностики работы сети: 
					• опция записать маршрут, при которой в IP-пакет
				  	  записывается адрес каждого маршрутизатора, через который он проходит.
					• опции временные метки, при установке которой, каждый маршрутизатор записывает время
					  прохождения пакета.
					• опции отказа от автоматической маршрутизации с заданием маршрута отправителя.
						- жесткая маршрутизация, при которой в пакете явно указывается перечень маршрутизаторов,
						  через которые нужно пройти.
						- свободная маршрутизация - указываются только некоторые маршрутизаторы, через которые
						  пакет должен пройти обязательно. При необходимости он может пройти через другие
						  маршрутизаторы.

				*Опции могут иметь разный размер
				*Длина заголовка должна быть кратна 32 битам.
				*Поэтому при необходимости в конце заголовок заполняется нулями для выравнивания по границе 32 бита.
				*Сейчас опции в заголовке IP почти не используются.


		3. МАРШРУТИЗАЦИЯ
			1. Это поиск маршрута доставки пакета между сетями через транзитные узлы - маршрутизаторы.
			2. Этапы маршрутизации:
				- изучение сети:
					-- какие подсети есть в этой составной сети
					-- какие есть маршрутизаторы
					-- как маршрутизаторы объединены между собой
				- продвижение пакетов на маршрутизаторе
					Варианты действий маршрутизатора:
					-- 1 вариант - сеть, которой предназначен пакет, подключена непосредственно к маршрутизатору.
					   В этом случае маршрутизатор передает пакет непосредственно в эту сеть.
					-- 2 вариант - нужная сеть подключена к другому маршрутизатору, нам известно какой маршрутизатор
					   нам нужен. В этом случае маршрутизатор передает пакет на следующий маршрутизатор, который
					   может передать пакет в нужную нам сеть. Такой маршрутизатор называется ШЛЮЗОМ.
					   Шлюз на сетевом уровне (или гейтвей — gateway) — это устройство, которое обеспечивает 
					   взаимодействие между двумя различными сетями, используя разные протоколы. На сетевом уровне 
					   шлюз может выполнять роль маршрутизатора, обеспечивающего передачу различными адресными схемами
					   (например, между локальной сетью и Интернетом).
					-- 3 вариант - пришел пакет для сети, маршрут которой мы не знаем, тогда маршрутизатор отбрасывает
					   пакет.
			2.1 ЧТО НУЖНО ЗНАТЬ МАРШРУТИЗАТОРУ, ЧТОБЫ ОТПРАВИТЬ ПАКЕТ:
				1. у маршрутизатора есть несколько интерфейсов, к которым подключена сеть. Нужно определить, в какой из
				   этих интерфейсов отправлять пакет.
				2. нужно определить, что делать с этим пакетом: либо передать в эту сеть, либо передать на один из
				   маршрутизаторов, подключенных к этой сети. Если передаем на маршрутизатор, нужно выбрать, на какой из
				   маршрутизаторов передавать пакет. 
				3. информацию о том, куда передавать пакет, маршрутизатор хранит в таблице маршрутизации.

					🔹 ОСНОВНЫЕ СОСТАВЛЯЮЩИЕ ТАБЛИЦЫ МАРШРУТИЗАЦИИ
					   1. Сетевой адрес (Network Destination / Prefix)
					      • Это IP-адрес сети или хоста, к которому относится маршрут.
						  • Может быть указана как полная сеть (192.168.1.0/24), так и конкретный узел
							(192.168.1.100/32).
   					      • Специальные маршруты:
   					      	- 0.0.0.0/0 — маршрут по умолчанию (default route).
   					      	- 127.0.0.0/8 — маршрут для локального хоста (localhost, loopback).
   					      	- 224.0.0.0/4 — маршруты для мульткаст-трафика.

   					   2. Маска подсети (Netmask / Prefix Length)
					   	  • Определяет, какая часть IP-адреса относится к сети, а какая к узлам в сети.
					   	  • Записывается в виде десятичной маски (255.255.255.0) или префикса (/24).

					   3. Шлюз (Gateway / Next Hop)
						  • Адрес следующего маршрутизатора, через который должен пройти пакет, чтобы попасть в целевую
						 	сеть.
					   	  • Если указано 0.0.0.0, маршрут считается "прямым" (находится в локальной сети).

					   4. Интерфейс (Interface)
					   	  • Сетевой интерфейс, через который должен отправляться трафик (например, eth0, wlan0).
							В Windows вместо названий сетевых интерфейсов используются IP-адреса.
					   	  • Если маршрут ведет в локальную сеть, интерфейс указывается без шлюза.

					   5. Метрика (Metric / Cost)
					   	  • Число, показывающее приоритет маршрута.
					   	  • Чем меньше значение метрики, тем предпочтительнее маршрут.
					   	  • Например, маршруты с метрикой 10 предпочтительнее, чем с метрикой 20.
					   		
			2.2 ДЛИНА МАСКИ МАРШРУТИЗАЦИИ:
				1. Правила маршрутизации:
					- поиск маршрута к хосту (маска/32). Если в таблице маршрутизации есть такой маршрут, то выбирается
					  он. Если в таблице есть точное совпадение IP-адреса с маской /32 (только один хост), то используется 
					  этот маршрут.
					- поиск маршрута к сети (с маской максимальной длины). После 1 пункта выполняется поиск маршрута к
					  подсети. Если /32 не найден, ищем ближайшую сеть с самой длинной маской.
					- маршрут по умолчанию (маска /0, подходит все). Только после 2 пункта используется маршрут по
					  умолчанию. Если ни один маршрут не подходит, используется маршрут по умолчанию (0.0.0.0/0), 
					  который отправляет пакеты "куда-то дальше" (например, на шлюз интернет-провайдера).

			3. Таблица маршрутизации есть не только у маршрутизатора, но и у всех хостов сети.
			   Содержание таблицы маршрутизации хоста:
					- присоединенная сеть, к которой подключен данный компьютер
					- адрес маршрутизатора по умолчанию, через который, как правило, выполняется подключение к интернет
					  или подключение к корпоративной сети
					- также могут быть некоторые дополнительные маршруты к знакомым сетям
						-- route print (Windows)
						-- route (Linux)

