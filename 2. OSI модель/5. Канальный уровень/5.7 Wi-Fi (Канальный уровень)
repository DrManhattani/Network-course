

	*Wi-Fi использует разделяемую среду передачи данных:
		- возможны коллизии
		- необходимо разграничивать доступ к разделяемой среде передачи данных

	ОСОБЕННОСТИ БЕСПРОВОДНОЙ СРЕДЫ ПЕРЕДАЧИ:
		- вероятность ошибки передачи выше, чем в проводной среде
		- мощность передаваемого сигнала выше, чем принимаемого
		- ограниченный диапазон распространения сигнала - не все компьютеры в сети
		  получают данные.
			*  В Wi-Fi, как и в Ethernet, компьютеры перед тем, как передавать данные, смотрят
			   несущую частоту, проверяют свободна ли она, и только затем решают передавать ли
			   данные.
			-- ПРОБЛЕМА СКРЫТОЙ СТАНЦИИ
			  *Возникает, когда два клиента Wi-Fi не видят друг друга, но оба находятся
			   в зоне покрытия одной точки доступа.
			   Например, устройство А может отправлять данные на точку доступа, не зная, что в 
			   этот момент устройство B тоже передаёт. Из-за этого возникают коллизии (потеря 
			   пакетов), так как точка доступа получает два сигнала одновременно. 
			-- ПРОБЛЕМА ЗАСВЕЧЕННОЙ СТАНЦИИ (Exposed Node Problem)
			  *Обратная ситуация: устройство А слышит устройство B, но они передают данные разным
			   точкам доступа и не мешают друг другу.
			   Однако, из-за этого А может ошибочно думать, что канал занят, и не передаёт данные, 
			   даже если мог бы.

	ПОДТВЕРЖДЕНИЕ ПОЛУЧЕНИЯ ПЕРЕДАВАЕМЫХ ДАННЫХ:
		- Т.к. ошибки возникают намного чаще, чем в проводной среде, то на канальном уровне
		  происходит подтверждение получения передаваемых данных.

	ОБНАРУЖЕНИЕ КОЛЛИЗИЙ:
		Ethernet
			- компьютер передает и одновременно принимает сигнал. Сравнивает сигнал, который
			  передает с тем, которы получает. Если сигнал отличается, значит произошла коллизия.
			- Jam последовательность для усугубления коллизии.
		Wi-Fi
			Здесь Jam последовательность использовать нельзя
			- Передаваемый сигнал сильнее получаемого
			- Сигнал о коллизии может не дойти до всех компьютеров в сети, например, из-за проблем
			  скрытой станции или проблемы засвеченной станции.
			Поэтому:
			- коллизии обнаруживаются по отсутствию подтверждения получения кадра
		В Ethernet коллизии обнаруживаются сразу после возникновения. Поэтому все компьютеры сразу
		останавливают передачу данных.
		В Wi-Fi на то, чтобы обнаружить коллизию требуется гораздо больше времени. В беспроводной 
		среде сложно понять, произошло ли столкновение сигналов. Поэтому Wi-Fi применяет избежание 
		коллизий вместо их обнаружения.


	МЕТОД ДОСТУПА К СРЕДЕ:
		CSMA/CA (CSMA COLLISION AVOIDANCE) - множественный доступ с прослушиванием несущей частоты
		с предотвращением коллизий.
		МОДЕЛЬ CSMA/CA:
			- Передача кадра
			- Короткий межкадровый интервал
				Компьютер, которому нужно отправить подтверждение или какой-либо другой служебный
				кадр, ждет в течение короткого межкадрового интервала. Именно за счет этого
				получается, что подтверждения отправляются быстрее, чем другие кадры.
			- Передача подтверждения
			- Межкадровый интервал
				Компьютер, который хочет отправить данные, должен выдержать обычный межкадровый
				интервал.
			- Период молчания
				После межкадрового интервала компьютеры вместо того, чтобы как можно быстрее
				начать передачу данных, наоборот стараются пропустить друг друга вперед, чтобы
				избежать коллизий. Каждый компьютер выбирает время для молчания. 
				Случайным образом генерируется число слотов ожидания - это промежуток времени
				в течение которого компьютер ждет. Длина слота ожидания разная для различных
				стандартов физического уровня Wi-Fi. Количество слотов ожидания выбирается случайным
				образом. Первым начинает передавать данные тот компьютер, который выбрал меньше
				всего слотов ожидания.

	Теоретически CSMA/CA не решает проблему скрытой и засвеченной станции, хотя и на практике он работает 
	всегда. Поэтому в Wi-Fi можно использовать другой метод доступа к среде передачи, который называется
	MACA.

		MACA (Multiple Access with Collision Avoidance) - метод доступа опциональный и используется очень
		редко.
			Решает проблему скрытой и засвеченной станции.			
			- Перед тем, как передавать данные, компьютер должен отправить управляющее сообщение:
			  RTS (Request to Send). В этот запрос включается размер данных, которые компьютер хочет
			  передать. 
			- Получатель в ответ управляющее сообщение CTS (Clear to Send) - в это сообщение включается
			  размер данных, которые компьютер готов принять.
			- Другие компьютеры, которые увидели сообщение CTS, ждут, когда закончится передача данных.
			  Они знают, сколько времени потребуется на передачу данных, т.к. размер данных включен
			  в сообщение CTS. И знают, сколько времени нужно на передачу подтверждения.



	ФОРМАТ КАДРА WI-FI уровня MAC:
		- На подуровне LLC формат кадра такой же, как и в Ethernet. Стандарт 802.2
		- На подуровне MAC формат кадра отличается. При реальной передаче данных по беспроводной среде
		  используется стандарт 802.11

	+-------------------------+-------------+------------------------------------------------------------------------+
	| Поле					  | Размер     	| Описание																 |
	+-------------------------+-------------+------------------------------------------------------------------------+
	| Frame Control		      | 2 байта    	| Управление кадром (тип, флаги)										 |
	| Duration/ID			  | 2 байта    	| Время ожидания (длительность) или ID - на какое время зарезервирован
											  канал передачи данных Wi-Fi. Используется вместе с управляющими кадрами
											  например, кадрами из протокола доступа к среде MAC					 |
	| Address 1				  | 6 байт     	| Адрес получателя в беспроводной среде						   		     |
	| Address 2 			  | 6 байт     	| Адрес отправителя в беспроводной среде								 |
	| Address 3 			  |	6 байт     	| Адрес получателя 														 |
	| Sequence Control		  | 2 байта 	| Управление очередностью (см. подробнее ниже ***)						 |
	| Address 4 			  | 6 байт 		| Адрес отправителя 													 |
	| Payload (Тело кадра)	  | 0-2304 байт | Полезные данные														 |
	| FCS (CRC)     		  | 4 байта	    | Контрольная сумма														 |
	+-------------------------+-------------+------------------------------------------------------------------------+

	Передача кадра в распределительную систему (от кадра в проводную среду и затем в интернет):
	+-------------------------+-------------+------------------------------------------------------------------------+
	| Поле					  | Размер     	| Описание																 |
	+-------------------------+-------------+------------------------------------------------------------------------+
	  .............
	| Address 1	(RA)		  | 6 байт     	| MAC-адрес точки доступа   											 |
	|										  - устройства, принимающего кадр ИЗ беспроводной среды (Receiver Adress)|
	| Address 2	(TA/SA)		  | 6 байт     	| MAC-адрес отправителя													 |
	|										  Source | Transmitter (передатчик) Adress (в этом случае совпадают)	 |
	|										  TA - передает кадр В беспроводную среду.								 |
	| Address 3	(DA)		  | 6 байт     	| MAC-адрес получателя (маршрутизатор, передающий данные в интернет 	 |
	  .............
	+-------------------------+-------------+------------------------------------------------------------------------+

	Передача кадра от распределительной системы :
	+-------------------------+-------------+------------------------------------------------------------------------+
    | Поле					  | Размер     	| Описание																 |
    +-------------------------+-------------+------------------------------------------------------------------------+
	  .............
    | Address 1	(RA/DA)		  | 6 байт     	| MAC-адрес получателя и устройства, принимающего данные ИЗ   		     |
	|										  беспроводной среды (совпадают).										 |
    | Address 2 (TA)		  | 6 байт     	| MAC-адрес устройства, передающего данные в беспроводную среду			 |
    | Address 3 (SA)		  | 6 байт     	| MAC-адрес отправителя 											 	 |
	  .............
    +-------------------------+-------------+------------------------------------------------------------------------+

	Если используется одноранговая сеть:
	+-------------------------+-------------+------------------------------------------------------------------------+
	| Поле					  | Размер     	| Описание																 |
	+-------------------------+-------------+------------------------------------------------------------------------+
	  .............
	| Address 1	(RA/DA)		  | 6 байт     	| MAC-адрес получателя и устройства, принимающего данные ИЗ   		     |
	|										  беспроводной среды (совпадают).										 |
	| Address 2 (TA/SA)		  | 6 байт     	| MAC-адрес отправителя и устройства, передающего данные в беспроводную	 |
	|										  среду																	 |
	| Address 3 			  |	6 байт     	| Идентификатор одноранговой сети BSSID, который генерируется автоматом	 |
	  .............
	+-------------------------+-------------+------------------------------------------------------------------------+

	Беспроводной мост (есть два проводных компьютера, которые передают данные друг другу через беспроводную сеть):
	+-------------------------+-------------+------------------------------------------------------------------------+
	| Поле					  | Размер     	| Описание																 |
	+-------------------------+-------------+------------------------------------------------------------------------+
	  .............
	| Address 1	(RA)		  | 6 байт     	| MAC-адрес устройства, принимающего данные ИЗ беспроводной среды 		 |
	| Address 2 (TA)		  | 6 байт     	| MAC-адрес устройства, передающего данные в беспроводную среду			 |
	| Address 3 (DA)		  |	6 байт     	| Получателя данных														 |
	| Address 4 (SA)		  | 6 байт 		| Адрес отправителя														 |
	  .............
	+-------------------------+-------------+------------------------------------------------------------------------+


		ПОЛЕ: УПРАВЛЕНИЕ КАДРОМ
		+-------------------------+-------------+------------------------------------------------------------------------+
		| Поле					  | Размер     	| Описание																 |
		+-------------------------+-------------+------------------------------------------------------------------------+
		| Версия протокола	      | 2 бита    	| Сейчас используется версия протокола 00 в 802.11. Остальные значения 
												  зарезервированы для будущего использования.
		| Тип					  | 2 бита    	| --Data(10) - передача данных (аналог Ethernet), 
													Назначение: Пересылка пользовательских данных (IP-пакеты, TCP/UDP 
													и т. д.).
												  --Control(01) - контрольные кадры, служебные, необходимы для обеспечения 
												    работы Wi-Fi, (RTS, CTS - протоколы доступа к срееде MAC). ACK - 
												    подтверждение успешной передачи кадра. 
													Назначение: Управление передачей данных, предотвращение коллизий и 
													подтверждение доставки.
												  --Management(00) - управляющие кадры, реализует различные сервисы Wi-Fi
													такие как подключение к точки доступа Wi-Fi и аутентификация. 
													Назначение: Настройка и управление соединением. Используются для 
													аутентификации, ассоциации и передачи служебной информации.
		| Подтип				  | 4 бита     	| Уточняет, какой именно кадр передаётся внутри основной категории (Type).						   		     |
		| To DS		 			  | 1 бит      	| Направление передачи кадра К проводной распределительной системе.		 |
												  To Destribution System.
		| From DS	 			  |	1 бит      	| От проводной среды через точку доступа к беспроводному компьютеру.
												  From Destribution System.			 									 |
		| MF(More Fragments)	  | 1 бит   	| См. подробнее  ***													 |
		| RT(Retry) 			  | 1 бит  		| Повторная передача кадра. 
												  --Выполняется, если отправитель не получил подтверждение передачи кадра.
												  --Если отправитель отправил подтверждение, а получатель его не получил,
												    то отправитель передает заново тот же самый кадр и устанавливает флаг
												    RT. Получатель получает кадр, видит, что установлен флаг RT, понимает,
												    что он уже получал такой кадр, ему снова необходимо отправить
												    подтверждение.
												 									 									 |
		| Power Management		  | 1 бит       | Управление питанием: станция сообщает точке доступа, что использует
												  управление питанием и работает в спящем режиме.
												  1-устройство переходит в режим сна, 0-активно																		 |
												  См. подробнее ****. Стандарт 811.11 PSM.
		| More Data				  | 1 бит		| Есть еще данные. Устанавливается точкой доступа при передаче кадра
												  станции, работающей в режиме сохранения питания. При получении кадра,
												  в котором установлен этот флаг, станция узнает, что у точки доступа
												  есть еще кадры, и запрашивает эти кадры у точки доступа. 
		| Protection Frame	      | 1 бит  	    | Применяется, чтобы указать используется шифрование данных или нет		 |
		| Order					  | 1 бит		| Говорит о том, сохраняется ли порядок передачи сообщений или нет.
												  На практике кадры принимаются в том же порядке, в котором они
												  направлены.
		+-------------------------+-------------+------------------------------------------------------------------------+



		ЧТО ДЕЛАТЬ, ЕСЛИ ОШИБКИ ВОЗНИКАЮТ ЧАСТО?
			Например, 1 ошибка на 1000 байт. Фактически, ошибка при передача каждого кадра.
			- Передавать в такой ситуации кадры можно, но длинные кадры нужно разбить на фрагменты менее 1000 байт.
			- Скорость упадет, но данные будут передаваться.
			Технология разделения 1 кадра на несколько маленьких кадров называется ФРАГМЕНТАЦИЯ. 

		*** В WI-FI ДЛЯ ФРАГМЕНТАЦИИ ИСПОЛЬЗУЕТСЯ 2 ПОЛЯ ФОРМАТА КАДРА:
			1. More Fragments - указывает, есть ли еще фрагменты кадра или это последний фрагмент. 1 - есть, 0 - последний.
			2. Sequence control - используется для нумерации кадров и для управления повторной передачей. Состоит из:
				2.1 Fragment Number, 4 бита - номер фрагмента внутри кадра. 
				2.2 Sequence Number, 12 бит - порядковый номер кадра в потоке передачи.

		**** IEEE 802.11 PSM
			- режим работы станции: активный и спящий
			- в спящем режиме станция не принимает и не передает данные
			- точка доступа записывает кадры для спящей станции в буфер
			- спящая станция регулярно просыпается и читает все кадры от точки доступа
			- передавать кадры станция может в любое время	



--------------------------СЕРВИСЫ--------------------------------

	1. Сервисы Ethernet - в проводных сетях есть лишь один тип сервисов - Передача Данных.
	   Для того, чтобы воспользоваться сетью Ethernet нужно просто подключиться к ней проводом.
	2. Сервисы Wi-Fi:
		- Ассоциация - перед тем, как передавать данные по беспроводной сети, вам нужно к ней подключиться.
		- Аутентификация - перед тем, как подключиться к сети, пользователь должен представиться и доказать, что он имеет
		  легальное право пользоваться этой сетью.
		- Передача данных
		- Защита данных (шифрование)
		- Роуминг (в расширенном наборе)
		- и др.

	WI-FI ПРЕДОСТАВЛЯЕТ 2 НАБОРА СЕРВИСОВ:
		1.БАЗОВЫЙ
		- есть 1 точка доступа, которая может использоваться сама по себе или быть подключена к распределительной системе.
		- в своем радиусе действия точка рассылает идентификаторы своего набора сервисов - BSSID (basic service set identifire)
		  Это просто MAC-адрес точки доступа.
		- кроме этого рассылается идентификатор набора сервисов в понятном для людей виде: текстовая строка.
		  SSID (service set identifire)

			1 ШАГ - чтобы подключиться к Wi-Fi - пройти аутентификацию.
				  - для этого клиент отправляет точке доступа кадр управления специального вида (Management Frame) с запросом на
				    аутентификацию.
				  - если запрос на аутентификацию удовлетворил точку доступа, она отправляет кадр с положительным ответом.
					ВИДЫ АУТЕНТИФИКАЦИИ:
					-- Открытая аутентификация - без пароля. В этом случа шифрование не используется, и все, что вы передаете по
					   открытым сетям, может быть перехвачено.
					-- Personal - единый пароль для всех устройств.
					-- Enterpise - отдельные пароли для разных пользователей сети, которые хранятся в каком-либо сервере
					   аутентификации, которые работают по протоколу RADIUS, LDAP и др.	 
					   Защищенность самая высокая, но такой подход требует дополнительной инфраструктуры, которую необходимо
					   поддерживать и развертывать.
			2 ШАГ - после успешной аутентификации клиент высылает запрос на АССОЦИАЦИЮ. В этом запросе клиент передает параметры
					Wi-Fi, с которыми он может работать. Если эти параметры подходят точке доступа, то она высылает в ответ
					кадр с успешной ассоциацией.
				    -- ОДНАКО, возможна более сложная ситуация. В этом случае после ассоциации клиет подключается к сети, но
					   не имеет права передавать данные. Для этого ему нужно пройти дополнительную аутентификацию, для которой,
					   как правило, используется какой-либо внешний сервис авторизации.
			3 ШАГ - когда аутентификация и ассоциация выполнены, клиент может передавать данные по беспроводной среде через точку
					доступа.
				  - если клиент хочет передавать данные другому клиенту, который тоже находится в этой же сети, то он все равно
					передает данные через точку доступа. Это сделано, чтобы упорядочить общений в разделяемом эфире.
			4 ШАГ - если клиент хочет отключиться от беспроводной среды, он отправляет сообщение на деассоциацию или
					деаутентификацию.
				  - точка доступа высылает ответ и отключает от сети. 
				  - если клиент вышел из зоны действия точки доступа, то точка доступа некоторое время помнит информацию об этом 
					клиенте, а затем автоматически отключает клиента.
		2. РАСШИРЕННЫЙ - полезно, когда необходимо раздавать Wi-Fi на большую территорию, которая больше, чем зона действия одной
		   точки доступа. В этом случае используется несколько точек доступа, которые согласованно работают между собой с помощью
		   внешнего контроллера.
			 - все точки доступа передают единый идентификатор набора сервисов SSID.
			 - BSSID у каждой точки доступа разный и, как правило, равен MAC-адресу этой точки доступа.
				  ПОЛЕЗНЫЕ СЕРВИСЫ РАСШИРЕННОГО НАБОРА:
					-- Роуминг - когда вы подключились к одной точке доступа, вы можете перейти в зону действия другой точки
					   доступа и продолжать работу. 
					   Когда вы проходите аутентификацию и ассоциацию в одной точке доступа, эта информация сохраняется не только
					   в этой точке доступа, но и в контроллере.
					   Клиент отправляет новой точке доступа запрос на реассоциацию, т.е. повторное подключение. Точка доступа
					   извлекает информацию о клиенте из контроллера. Если все хорошо, то клиент работает с новой точкой доступа.
		
		КАК КЛИЕНТ УЗНАЕТ, КАКИЕ ТОЧКИ ДОСТУПА И СЕТИ ЕСТЬ ТАМ, ГДЕ ОН НАХОДИТСЯ:
			- Пассивное сканирование - все точки доступа регулярно рассылают специальные широковещательные кадры с информацией
			  о себе, так называемые, Beacon frame. Этот кадр содержит идентификатор сети и идентификатор набора базовых сервисов.
			  При пассивном сканировании клиент принимает кадры от таких точек доступа и через некоторое время узнает о всех сетях.
			- Активное сканирование	- если клиент хочет быстрее получить информацию о доступных сетях, клиент использует активное
			  сканирование. Для этого рассылается специальный широковещательный запрос PROBE ко всем точкам доступа. Получив
			  такой запрос, точки доступа рассылают информацию о сетях, которые они обслуживают.

		ШИФРОВАНИЕ
			- Информацию, которую мы передаем по беспроводным сетям доступна всем. Аналогично концентратору Ethernet.
			- В Wi-Fi используется шифрование данных, но не заголовков. Для того, чтобы указать, что кадр зашифрован используется
			  специальный флаг заголовка Protection Frame (WEP, Wired Equivalent Privacy) - приватность эквивалентная проводному
			  соединению.
			- Поддерживается несколько типов шифрования:
				-- WEP - на практике сейчас уже не используется, т.к. его очень просто взломать
				-- Wi-Fi Protected Access (WAP)
				-- Wi-Fi Protected Access 2 (WAP2) - в настоящее время предоставляет наивысшую защиту

