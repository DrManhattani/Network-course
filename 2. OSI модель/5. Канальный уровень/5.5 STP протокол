
	✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤ ПРОТОКОЛ STP ✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤✤

	КОЛЬЦЕВОЕ СОЕДИНЕНИЕ КОММУТАТОРОВ:
	- Такое соединение не может работать, может возникнуть широковещательный шторм.
		-- Предположим, на коммутатор 1 пришел кадр, который коммутатор не знает куда отправить.
		-- Он отправляет кадр на все порты, кроме порта, откуда кадр пришел.
		-- Все компьютеры этого коммутатора отбросят кадр, т.к. он им не предназначался.
		-- Кадр получают коммутаторы 2, 3.
		-- Предположим, они тоже не знают, на какому порту находится получатель. Они отправляют
		   кадр на все порты, кроме порта, откуда пришел кадр.
		-- Кадр поступает на коммутатор 4 сразу от двух других коммутаторов. Этот кадр одинаковый
		   на обоих портах.
		-- Если не будет найден получатель на 4 коммутаторе, то кадр будет повторно отправлен на
		   все порты, кроме принимающего. Получится так, что кадр, поступивший из 3 коммутатора
		   отправится на порт 2 коммутатора и наоборот. Т.к. коммутатор не может различать
		   одинаковые кадры.
		-- И отправка кадра начнет повторяться по кругу.


	ПРОТОКОЛ STP:
	- Spannnig Tree Protocol, Протокол связующего (остовного) дерева. Позволяет отключать на
	  программном уровне некоторые соединения между коммутаторами, чтобы не образовывалось
	  кольцо.
	- Связующее дерево (оставное) - подграф без циклов, который содержит все вершины исходного
	  графа. Т.е. связующее дерево содержит все исходные коммутаторы, но при этом в нем нет циклов.

	- Протокол STP определен в стандарте IEEE 802.1D - благодаря протоколу мы можем создавать несколько
	  соединений между коммутаторами. Это повышает надежность работы нашей сети. Если одно соединение
	  разорвется, то можно будет использовать другое соединение.
	  Протокол защищает сеть от ошибок конфигурации. Например, если вы воткнули кабель не в тот коммутатор
	  и случайно создали кольцо.
	- Протокол находится на канальном уровне. Реализуется на коммутаторах.


	ЭТАПЫ РАБОТЫ ПРОТОКОЛА:
	- выбор корневого коммутатора.
	- рассчитываются кратчайшие пути от всех коммутаторов сети до корневого коммутатора.
	- отключаются все соединения, кроме кратчайших.

	РЕАЛИЗАЦИЯ:
	- для того чтобы, реализовать протокол STP коммутаторы обмениваются между собой сообщениями, которые
	  называются BPDU (bridge protocol data units). Такие протоколы отправляют все коммутаторы сети, 
	  поддерживающие протокол STP, каждые 2 секунды.
	- в качестве MAC-адреса получателя используется групповой адрес сети 01:80:C2:00:00:00.

	1. На первом этапе выполняется выбор коммутатора. В качестве корневого выбирается коммутатор, имеющий
	   меньший идентификатор (MAC-адрес). Можно повлиять на значение идентификатора вручную, чтобы выбрать
	   в качестве корневого наиболее мощный коммутатор.
	2. В начале коммутаторы не знают об идентификаторах других коммутаторов. Они отправляют сообщения другим
	   коммутаторам, а также получают сообщения от других коммутаторов. Получив идентификатор соседей,
	   коммутаторы сравнивают идентификатор в сообщении со своим идентификатором. Последующие сообщения
	   коммутаторы будут рассылать с минимальным идентификатором коммутатора, который они узнали от своих
	   соседей. Когда все коммутаторы выбирают один корневой, выбор коммутатора на этом заканчивается.
	3. Далее все коммутаторы выбирают кратчайшие пути до корневого коммутатора. Выбор кратчайшего пути
	   похож на выбор корневого коммутатора. Коммутаторы рассылают на все порты управляющее сообщение 
	   протокола STP с расстоянием от них до корневого коммутатора (BPDU). Расстояние между коммутаторами
	   определено в стандарте IEEE 802.1D. 
	   На первом этапе коммутаторы, которые подключены непосредственно к корневому коммутатору определяют
	   скорость соединения с этим коммутатором и выбирают соответствующее значение расстояния.
	   Затем это кратчайшее расстояние рассылается на следующие коммутаторы. Следующий коммутатор определяет
	   скорость значения с предыдущим коммутатором, выбирает значение расстояния и прибавляет к нему значение,
	   полученное от предыдущего коммутатора.
	4. Если у нас есть 2 пути до корневого коммутатора, мы должны выбрать путь с минимальным расстоянием,
	   а другой путь отключить. Если расстояние одинаково, отключается тот путь, у которого больше значение
	   порта.
	5. Если будет разрыв выбранного соединения с минимальным расстоянием, то мы имеем право включить отключенный
	   порт.

	  -----------------------------------------------------	
	  | Скорость соединения	|  Стоимость соединения в STP |
	  |		  Mbit/s		|		   IEEE 802.1D		  |
	  -----------------------------------------------------
	  |			4			|			250				  |
	  |			10			|			100				  |
	  |			16			|			62				  |
	  |			100			|			19				  |
	  |			1000		|			4				  |
	  |			2000		|			3				  |
	  |			10000		|			2				  |
	  -----------------------------------------------------

	СОСТОЯНИЕ ПОРТОВ STP:
		* При подключении устройства к коммутатору нельзя сразу отправлять данные, ведь там может оказаться
		  другой коммутатор, и новое соединение может привести к созданию кольца. Чтобы избежать этой проблемы
		  коммутаторы использують несколько режимов работы портов.
		1. Listening - порт обрабатывает управляющие сообщения протокола STP (BPDU), но не передает данные.
		2. Learning - порт не передает кадры, но изучает MAC-адреса в поступающих кадрах и формирует таблицу
		   коммутации.
		3. Forwarding - если к порту подключен компьютер или коммутатор без образования кольца, то порт принимает
		   и передает данные, а также принимает и передает управляющие сообщения протокола STP.
		4. Blocking - если к порту подключен коммутатор и образовалось кольцо, порт блокируется, чтобы избежать
		   кольцевого соединения.
		5. Disabled - у админа есть право выключить порт вручную.


	Раньше переход от Listening до Forwarding занимало 30 секунд. Поэтому был предложен новый вариант протокола STP,
	который называтеся RSTP (Rapid). RSTP срабатывает за пару секунд. Определяется в стандарте IEEE 802.1w.

	Для соединения протокола STP с VLAN был разработан новый протокол MSTP (Multiple). Стандарт IEEE 802.1s.
	Создается связующее дерево для каждого VLAN.
